name: Meowt Moderation Bot

on:
  schedule:
    - cron: "*/1 * * * *"   # every minute
  workflow_dispatch: {}

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20

      # Install deps (works whether or not you already have a package.json)
      - name: Install dependencies
        run: |
          npm ci || true
          npm ls viem >/dev/null 2>&1 || npm i viem

      - name: Run moderator
        run: node bot/moderator.mjs
        env:
          RPC_URL: ${{ secrets.RPC_URL }}
          GAME_ADDRESS: ${{ secrets.GAME_ADDRESS }}
          BOT_PRIVATE_KEY: ${{ secrets.BOT_PRIVATE_KEY }}
          PERSPECTIVE_API_KEY: ${{ secrets.PERSPECTIVE_API_KEY }}
          # Optional repo variables (Actions â†’ Variables)
          TOXICITY_THRESHOLD: ${{ vars.TOXICITY_THRESHOLD }}
          INSULT_THRESHOLD:   ${{ vars.INSULT_THRESHOLD }}
          PROFANITY_THRESHOLD: ${{ vars.PROFANITY_THRESHOLD }}
          THREAT_THRESHOLD:   ${{ vars.THREAT_THRESHOLD }}
          PERSPECTIVE_LANG:   ${{ vars.PERSPECTIVE_LANG }}
